(window["matrixElement_jsonp"]=window["matrixElement_jsonp"]||[]).push([[0],{"0826":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"typingBlock",staticStyle:{position:"relative"}},[n("div",{staticClass:"typingBlockWrapper"},[n("div",[n("span",[e._v(e._s(e.$t("caption.typing")))])]),n("div",[n("PulseLoader",{attrs:{color:e.color,size:e.size,loading:!0}})],1)])])},a=[],o=n("8a5d"),r={name:"typing",props:{},components:{PulseLoader:o["a"]},data:function(){return{color:"#868686",size:"2px",loading:!0}},methods:{},computed:{}},s=r,c=n("2877");function l(e){var t=n("1b86");t.__inject__&&t.__inject__(e)}var d=Object(c["a"])(s,i,a,!1,l,null,null,!0);t["a"]=d.exports},"0b99":function(e,t,n){var i=n("a9e7");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("35d6").default;e.exports.__inject__=function(e){a("700bd990",i,e)}},"13f0":function(e,t,n){var i=n("4fd2");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("35d6").default;e.exports.__inject__=function(e){a("b890812c",i,e)}},1456:function(e,t,n){var i=n("1752");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("35d6").default;e.exports.__inject__=function(e){a("c049a4fa",i,e)}},1752:function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,"#matrix-root[theme=white] #events[data-v-f1acd360]{transition:.3s}#matrix-root[theme=white] .dummyheight[data-v-f1acd360]{background:#000}#matrix-root[theme=white] .preloadingWrapper[data-v-f1acd360]{color:#02061a}#matrix-root[theme=white] .scrollbottom[data-v-f1acd360]{background:#fff;box-shadow:0 5px 7px -5px rgba(2,6,26,.7);color:#002a52}#matrix-root[theme=white] .galleryRow .messageImg .metaLink[data-v-f1acd360]{background:#000}",""]),e.exports=t},"1b86":function(e,t,n){"use strict";n.r(t);var i=n("5f7e");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a)},"1f0a":function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,"#matrix-root[theme=black] #events[data-v-f1acd360]{transition:.3s}#matrix-root[theme=black] .dummyheight[data-v-f1acd360]{background:#000}#matrix-root[theme=black] .preloadingWrapper[data-v-f1acd360]{color:#c6c8d1}#matrix-root[theme=black] .scrollbottom[data-v-f1acd360]{background:#00060c;box-shadow:0 5px 7px -5px rgba(2,6,26,.7);color:silver}#matrix-root[theme=black] .galleryRow .messageImg .metaLink[data-v-f1acd360]{background:#000}",""]),e.exports=t},"270f":function(e,t,n){"use strict";n.r(t);var i=n("40fa");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a)},"3b52":function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,"",""]),e.exports=t},"40fa":function(e,t,n){var i=n("4f4e");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("35d6").default;e.exports.__inject__=function(e){a("bf51b906",i,e)}},4654:function(e,t,n){"use strict";n.r(t);var i=n("13f0");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a)},"4e29":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active},attrs:{id:"chatList"}},[n("div",{ref:"work",staticClass:"work"},[n("div",{ref:"events",staticClass:"timeLineWrapper"},[e.timeline?n("events",{ref:"eventslist",attrs:{timeline:e.timeline,events:e.events,chat:e.chat,loading:e.lloading,scrollType:e.scrollType},on:{updated:e.updatedSize,scroll:e.scrollE,removeEvent:e.removeEvent,editingEvent:e.editingEvent,replyEvent:e.replyEvent,galleryEventOpen:function(t){return e.imageGallery(t)},menuIsVisible:e.menuIsVisibleHandler}}):e._e()],1)])])},a=[],o=n("1da1"),r=n("a34a"),s=n.n(r),c=(n("4de4"),n("b64b"),n("d3b7"),n("e6cf"),n("2f62")),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"maskedtop",class:{mobile:e.mobile,ios:e.ios,menuOpen:e.menuOpen,imagesList:"custom"===this.scrollType?"imagesList":""},attrs:{id:"events"}},[n("div",e._g({ref:"container",staticClass:"eventsflex",class:{mobile:e.mobile,ios:e.ios,menuOpen:e.menuOpen},on:{mousewheel:e.mousewheel,scroll:e.dscroll}}),[n("div",{staticClass:"ewr"},e._l(e.events,(function(t,i){return n("div",{key:t.event.event_id,staticClass:"eventWrapper"},[n("eventsEvent",{attrs:{event:t,prevevent:e.events[i+1],galleryData:e.events,chat:e.chat,timeline:e.timeline,last:0==i},on:{openImageEvent:function(t){return e.galleryOpen(t)},removeEvent:function(n){return e.removeEvent(t)},editing:function(n){return e.editingEvent({event:t,text:n})},reply:function(n){return e.replyEvent({event:t})},mounted:e.emounted,menuIsVisible:e.menuIsVisibleHandler}})],1)})),0),e.loading?n("div",{staticClass:"preloadingWrapper"},[n("linepreloader")],1):e._e()]),n("transition",{attrs:{name:"fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.scrollbottomshow,expression:"scrollbottomshow"}],staticClass:"scrollbottom",on:{click:e.scrolldown}},[n("i",{staticClass:"fas fa-chevron-down"})])])],1)},d=[],u=n("5530"),f=n("3139"),m=n("c46f"),v={name:"events",props:{timeline:Object,events:Array,chat:Object,loading:Boolean,scrollType:""},components:{},data:function(){return{type:"",tmt:null,lscroll:null,menuOpen:!1,c:1,ls:0}},watch:{events:function(){}},computed:Object(u["a"])(Object(u["a"])({ios:function(){return f["a"].isios()}},Object(c["c"])({auth:function(e){return e.auth},mobile:function(e){return e.mobile},scrollbottomshow:function(){return this.lscroll&&this.lscroll.scrollTop>500}})),{},{eventsByPages:function(){var e=[],t=0;return m["each"](this.events,(function(n){t||e.push([]),e[e.length-1].push(n),t++,t>19&&(t=0)})),e}}),destroyed:function(){this.core.menu(null)},mounted:function(){},methods:{dupdated:m["debounce"]((function(){this.$emit("updated",this.size())}),75),dscroll:m["debounce"]((function(){return this.scroll()}),35),ddscroll:function(e){this.dscroll()},emounted:function(){this.$nextTick((function(){this.scrollCorrection(),this.dupdated()}))},scroll:function(){this.$emit("scroll",this.size())},size:function(){var e={scrollHeight:0,scrollTop:0,clientHeight:0};return this.$refs["container"]&&(e.scrollHeight=this.$refs["container"].scrollHeight,e.scrollTop=this.c*this.$refs["container"].scrollTop,e.clientHeight=this.$refs["container"].clientHeight),this.lscroll=e,e},editingEvent:function(e){var t=e.event,n=e.text;this.$emit("editingEvent",{event:t,text:n})},replyEvent:function(e){var t=e.event;this.$emit("replyEvent",{event:t})},removeEvent:function(e){this.$emit("removeEvent",e)},showPhotoSwipe:function(e){this.isOpen=!0,this.$set(this.options,"index",e)},hidePhotoSwipe:function(){this.isOpen=!1},galleryOpen:function(e){this.$emit("galleryEventOpen",e)},scrolldown:function(){this.scrollToNew(0)},scrollCorrection:function(){},scrollToNew:function(e){this.$refs["container"]&&(this.$refs["container"].scrollTop=this.c*e)},menuIsVisibleHandler:function(e){this.menuOpen=e,this.$emit("menuIsVisible",e)},mousewheel:function(e){if("custom"!==this.scrollType){e.preventDefault();var t=e.deltaY;return this.$refs["container"].scrollTop+=t>0?-60:60,!1}}}},h=v,p=n("2877");function g(e){var t=n("4654");t.__inject__&&t.__inject__(e);var i=n("f4cb");i.__inject__&&i.__inject__(e);var a=n("dd92");a.__inject__&&a.__inject__(e)}var b=Object(p["a"])(h,l,d,!1,g,"f1acd360",null,!0),x=b.exports,y={name:"chatList",props:{chat:Object,filterType:String},components:{events:x},data:function(){return{encryptedEvents:[],loading:!1,scrolling:!1,scrollingTo:0,cancelNextScroll:!1,timeline:null,lastEvent:{},scrollType:String,esize:{},p_b:!1,p_f:!1,updateTimeout:null,updateInterval:null,events:[],firstPaginate:!0}},mounted:function(){this.init(),this.chat&&this.readAll()},watch:{active:function(){this.minimized&&!this.active&&this.scrollToNew(0),this.minimized&&this.active&&this.readAll()}},computed:Object(c["c"])({lloading:function(){return this.loading||this["p_f"]||this["p_b"]},auth:function(e){return e.auth},settings_read:function(e){return!e.dontreadreceipts},eventsTypes:function(){var e={"m.room.message":!0,"p.room.encrypt.message":!0,"m.room.image":!0,"m.room.file":!0,"m.room.member":!0,"m.fully_read":!0};return _.toArray(this.chat&&this.chat.currentState.members||{}).length>2&&(e["m.room.member"]=!0,e["m.room.power_levels"]=!0),e},pocketnet:function(e){return e.pocketnet},minimized:function(e){return e.minimized},active:function(e){return e.active},bin:function(e){return e.pocketnet}}),created:function(){this.updateInterval=setInterval(this.update,300)},destroyed:function(){this.timeline&&this.timeline.unpaginate(this.timeline._eventCount,!0),clearInterval(this.updateInterval)},methods:{editingEvent:function(e){var t=e.event,n=e.text;this.$emit("editingEvent",{event:t,text:n})},replyEvent:function(e){var t=e.event;this.$emit("replyEvent",{event:t})},removeEvent:function(e){this.chat.getLiveTimeline().removeEvent(e.event.event_id)},wh:function(){if(this.esize.clientHeight)return this.esize.clientHeight},getEvents:function(){var e=this,t=this.timeline.getEvents();return t=_.filter(t,(function(t){var n=t.event.type;if(!t.localRedactionEvent()&&!t.getRedactionEvent()&&("m.room.power_levels"!==t.event.type||1!==Object.keys(t.event.content.users).length)&&!(e.chat.currentState.getMembers().length<=2&&"m.room.member"===t.event.type))return!e.eventsTypes||e.eventsTypes[n]})),t=t.reverse(),this.relations(t),t=_.sortBy(t,(function(e){return e.replacingEventDate()||e.getDate()||1/0})),t=t.reverse(),t=_.uniq(t,(function(t){return e.core.mtrx.clearEventId(t)||f["a"].makeid()})),t=_.sortBy(t,(function(e){return e.getDate()||1/0})),t=t.reverse(),this.$emit("getEvents",t),t},relations:function(e){var t=this.timeline._timelineSet;_.each(e,(function(e){try{var n=t.getRelationsForEvent(e.event.event_id,"m.replace","m.room.message");if(n){var i=n.getLastReplacement();i&&(e.event.content.body=i.event.content.body,e.event.content.edited=i.event.event_id,e.event.content.block=i.event.content.block,e.event.content.msgtype=i.event.content.msgtype)}}catch(e){console.error(e)}}))},mediaTimelineSet:function(){var e=Object(o["a"])(s.a.mark((function e(){var t;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=new core.mtrx.sdk.Filter(client.getUserId()),t.setDefinition({room:{timeline:{contains_url:!0,types:["m.room.message"]}}}),e.next=4,client.getOrCreateFilter("FILTER_FILES_"+client.credentials.userId,t);case 4:return t.filterId=e.sent,e.abrupt("return",this.chat.getOrCreateFilteredTimelineSet(t));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),init:function(){var e=Object(o["a"])(s.a.mark((function e(){var t,n,i=this;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.loading=!0,this.firstPaginate=!0,t=this.chat.getLiveTimeline(),"images"!==this.filterType){e.next=10;break}return this.scrollType="custom",e.next=7,this.mediaTimelineSet();case 7:n=e.sent,e.next=11;break;case 10:n=t.getTimelineSet();case 11:this.timeline=new this.core.mtrx.sdk.TimelineWindow(this.core.mtrx.client,n),setTimeout((function(){i.timeline.load().then(function(){var e=Object(o["a"])(s.a.mark((function e(t){return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i.events=i.getEvents(),i.loading=!1,setTimeout((function(){i.autoPaginateAll()}),300);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){i.loading=!1}))}),30);case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),autoPaginate:function(e){this.needLoad(e)&&this.paginate(e)},paginate:function(e,t){var n=this;if(!this.loading&&this.timeline&&!this["p_"+e])if(this.timeline.canPaginate(e)||t){this["p_"+e]=!0;var i=20;this.timeline.paginate(e,i).then((function(e){return Promise.resolve()})).catch((function(e){return Promise.resolve()})).then((function(t){setTimeout((function(){n.events=n.getEvents(),n.firstPaginate=!1,n.readAll(),n["p_"+e]=!1}),100)}))}else this.readAll()},autoPaginateAll:function(){"images"===this.filterType?this.autoPaginate("b"):(this.autoPaginate("b"),this.autoPaginate("f"))},needLoad:function(e){var t=!1,n=this.esize.scrollHeight||0,i=this.esize.scrollTop||0,a=Math.max(this.esize.clientHeight||0,800);if("b"==e){var o=a;n-i<a+o&&(t=!0)}else i<a&&(t=!0);return t},readEvent:function(e){var t=this.core.mtrx.me(e.event.sender);t||this.core.mtrx.client.sendReadReceipt(e)},readFirst:function(){var e=this.timeline.getEvents();this.readEvent(e[0])},readLast:function(){var e=this.timeline.getEvents();this.readEvent(e[e.length-1])},readEvents:function(e){var t=this;_.each(e,(function(e){t.readEvent(e)}))},readOne:function(){this.core.mtrx.client(this.chat.timeline[this.chat.timeline.length-1]).then((function(e){return e}))},readAll:function(){var e=this;document.hasFocus()&&(!this.pocketnet||this.active)&&!this.core.hiddenInParent&&this.chat&&this.chat.getJoinedMemberCount()>0&&0!==this.chat.getUnreadNotificationCount()&&setTimeout((function(){if(e.chat){var t=e.chat.timeline.length-1,n=null;while(t>=0&&!n){var i=e.chat.timeline[t];e.core.mtrx.me(i.sender.userId)||(n=i),t--}e.core.mtrx.client.setRoomReadMarkers(e.chat.currentState.roomId,i.eventId,i,{hidden:!e.settings_read}).then((function(e){return e}))}}),1e3)},scrollE:function(e){this.updatedSize(e),this.$emit("scroll",e)},updatedSize:function(e){this.esize=e},update:function(e){this.scrolling||this.autoPaginateAll()},scrollToNew:function(e){this.scrolling=!0,this.$refs.eventslist.scrollToNew(e),this.scrolling=!1},imageGallery:function(e){this.$emit("eventImage",e)},menuIsVisibleHandler:function(e){this.$emit("menuIsVisible",e)}}},w=y;function k(e){var t=n("270f");t.__inject__&&t.__inject__(e);var i=n("d0ad");i.__inject__&&i.__inject__(e);var a=n("a317");a.__inject__&&a.__inject__(e)}var E=Object(p["a"])(w,i,a,!1,k,"b34faadc",null,!0);t["a"]=E.exports},"4f4e":function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,"[data-v-b34faadc] .eventMember{text-align:left}[data-v-b34faadc] .eventMember span{font-size:.9em}.pswp img[data-v-b34faadc]{max-width:none;-o-object-fit:contain;object-fit:contain}#chatList.minimized:not(.active) .timeLineWrapper[data-v-b34faadc]{padding-left:.5em}",""]),e.exports=t},"4fd2":function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,".eventWrapper[data-v-f1acd360] .event{padding:.25em 0}.list-enter-active[data-v-f1acd360],.list-leave-active[data-v-f1acd360]{transition:all 1s}.list-enter[data-v-f1acd360],.list-leave-to[data-v-f1acd360]{opacity:0}#events[data-v-f1acd360]{left:0;right:0;top:0;bottom:0;padding-bottom:46px;position:absolute;transition:.3s}#events.mobile[data-v-f1acd360]{padding-bottom:77px}#events.mobile .scrollbottom[data-v-f1acd360]{bottom:5em}.dummyheight[data-v-f1acd360]{height:100%;width:2px;left:0;right:0;top:0;bottom:0;background:#000}.preloadingWrapper[data-v-f1acd360]{padding:2em;text-align:center;opacity:.5;color:#02061a}.scrollbottom[data-v-f1acd360]{position:absolute;right:.5em;bottom:4em;cursor:pointer;border-radius:50%;background:#fff;box-shadow:0 5px 7px -5px rgba(2,6,26,.7);color:#002a52;width:35px;height:35px;line-height:35px;text-align:center;z-index:3}.scrollbottom i[data-v-f1acd360]{font-size:.7em}.eventsflex[data-v-f1acd360]{display:flex;flex-flow:column;overflow-y:overlay;overflow-x:hidden;max-width:768px;margin:0 auto;-webkit-overflow-scrolling:touch;-ms-scroll-chaining:none;overscroll-behavior:contain;flex-wrap:nowrap;width:100%;height:100%;scroll-behavior:auto;continue:fragments;justify-content:flex-start;transform:scaleY(-1)}.eventsflex.freeze[data-v-f1acd360]{overflow-y:hidden}.eventsflex .eventspage[data-v-f1acd360],.eventsflex .ewr[data-v-f1acd360]{width:100%;display:flex;flex-flow:column;flex-wrap:nowrap;justify-content:flex-start}.eventsflex .eventWrapper[data-v-f1acd360]{width:100%;transform:scaleY(-1)}.eventsflex.mobile[data-v-f1acd360]{scroll-behavior:smooth}.eventsflex.mobile[data-v-f1acd360] .dropdown.visible{top:-55px}.eventsflex.mobile[data-v-f1acd360] .outer-div .backgr,.eventsflex.mobile[data-v-f1acd360] .outer-div .menuwrapper{position:absolute}.eventsflex.mobile.ios.menuOpen[data-v-f1acd360]{overflow:visible}.galleryRow[data-v-f1acd360]{display:flex;align-items:flex-end}.galleryRow .messageImg[data-v-f1acd360]{max-width:50%;margin:0 10px;position:relative}.galleryRow .messageImg .img[data-v-f1acd360]{display:block;border-radius:.5em;position:relative;max-width:100%}.galleryRow .messageImg .loadingImg[data-v-f1acd360]{display:flex;align-items:center;justify-content:center;border-radius:.5em;position:relative;max-width:300px;height:250px}.galleryRow .messageImg .loadingImg .imgPreview[data-v-f1acd360]{border-radius:.5em;position:relative;max-width:100%;height:100%;opacity:.6}.galleryRow .messageImg .loadingImg .clipLoader[data-v-f1acd360]{position:absolute;z-index:9999;left:50%;right:0;top:50%;bottom:0;transform:translate(-50,50);display:flex;align-items:center;justify-content:center}.galleryRow .messageImg .imgMsg img[data-v-f1acd360]{max-width:100%;-o-object-fit:cover;object-fit:cover;border-radius:1em;display:block}.galleryRow .messageImg .metaLink[data-v-f1acd360]{background:#000}.galleryRow .messageImg .metaLink .metaMessageLink .metaTitle[data-v-f1acd360]{font-weight:700;font-size:.9em}.galleryRow .messageImg .metaLink .metaMessageLink .metaDescription[data-v-f1acd360]{margin:.5em 0;font-size:.8em}.galleryRow .messageImg .metaLink .metaMessageLink .metaImgWrapper[data-v-f1acd360]{display:block;max-width:300px;-o-object-fit:cover;object-fit:cover}.galleryRow .messageImg .metaLink .metaMessageLink .metaImgWrapper img[data-v-f1acd360]{display:block;width:100%;height:100%}",""]),e.exports=t},"5f7e":function(e,t,n){var i=n("bd86");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("35d6").default;e.exports.__inject__=function(e){a("3c4a7888",i,e)}},9006:function(e,t,n){var i=n("1f0a");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("35d6").default;e.exports.__inject__=function(e){a("4f935478",i,e)}},"93bb":function(e,t,n){var i=n("3b52");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("35d6").default;e.exports.__inject__=function(e){a("054eab91",i,e)}},a317:function(e,t,n){"use strict";n.r(t);var i=n("93bb");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a)},a9e7:function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,"",""]),e.exports=t},bd86:function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,".typingBlock{position:relative}.typingBlock .typingBlockWrapper{position:absolute;left:50%;transform:translateX(-50%);top:-5px;display:flex;align-items:center}.typingBlock .typingBlockWrapper>div{padding:0 .5em}.typingBlock .typingBlockWrapper span{font-size:.7em;color:#707070;opacity:.8}",""]),e.exports=t},d0ad:function(e,t,n){"use strict";n.r(t);var i=n("0b99");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a)},dd92:function(e,t,n){"use strict";n.r(t);var i=n("9006");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a)},f4cb:function(e,t,n){"use strict";n.r(t);var i=n("1456");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a)}}]);
//# sourceMappingURL=matrix-element.0.min.js.map